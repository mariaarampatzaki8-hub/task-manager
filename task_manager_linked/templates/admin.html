{% extends "base.html" %}
{% block content %}

<h1>Admin</h1>

<div class="card">
  <h3>Δημιουργία Χρήστη</h3>
  <form method="post" action="{{ url_for('admin_create_user') }}">
    <div class="grid">
      <div>
        <label>Username</label>
        <input name="username" required>
      </div>
      <div>
        <label>Κωδικός</label>
        <input name="password" type="password" required>
      </div>
      <div>
        <label>Email</label>
        <input name="email" type="email" placeholder="προαιρετικό">
      </div>
      <div>
        <label>Χρώμα</label>
        <input name="color" type="color" value="#3273dc">
      </div>
      <div>
        <label>Ομάδα</label>
        <select name="team_id">
          <option value="">(καμία)</option>
          {% for t in teams %}
            <option value="{{ t.id }}">{{ t.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>Διαχειριστής</label>
        <input name="is_admin" type="checkbox">
      </div>
    </div>
    <button type="submit">Δημιουργία</button>
  </form>
</div>

<div class="card">
  <h3>Δημιουργία/Ανάθεση Task</h3>
  <form method="post" action="{{ url_for('admin_create_task') }}">
    <div class="grid">
      <div class="col-span-2">
        <label>Τίτλος</label>
        <input name="title" required placeholder="π.χ. Υποβολή αναφοράς">
      </div>
      <div>
        <label>Ανάθεση σε</label>
        <select name="assignee_username" required>
          {% for u in users %}
            <option value="{{ u.username }}">{{ u.username }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>Πρόοδος (%)</label>
        <input name="progress" type="number" min="0" max="100" value="0">
      </div>
    </div>
    <button type="submit">Δημιουργία Task</button>
  </form>
</div>

<div class="card">
  <h3>Εργασίες (Tasks)</h3>
  {% if tasks %}
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Τίτλος</th>
          <th>Χρήστης</th>
          <th>Κατάσταση</th>
          <th>Πρόοδος</th>
          <th>Ενέργειες</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tasks %}
        <tr>
          <td>#{{ t.id }}</td>
          <td>{{ t.title }}</td>
          <td>
            {% set uname = user_map.get(t.assignee_id) %}
            {{ uname if uname else "-" }}
          </td>
          <td>{{ "Ολοκληρωμένο" if t.status == "done" else "Ανοιχτό" }}</td>
          <td>{{ t.progress }}%</td>
          <td>
            <form method="post" action="{{ url_for('admin_toggle_task', task_id=t.id) }}" style="display:inline">
              <button type="submit">{{ "Άνοιγμα" if t.status == "done" else "Ολοκλήρωση" }}</button>
            </form>
            <form method="post" action="{{ url_for('admin_delete_task', task_id=t.id) }}" style="display:inline" onsubmit="return confirm('Διαγραφή task;');">
              <button type="submit">Διαγραφή</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Δεν υπάρχουν εργασίες ακόμη.</p>
  {% endif %}
</div>

<div class="card">
  <h3>Χρήστες</h3>
  <ul>
    {% for u in users %}
      <li>{{ u.username }} {% if u.is_admin %}(admin){% endif %}</li>
    {% endfor %}
  </ul>
</div>

<div class="card">
  <h3>Ομάδες</h3>
  <p><a href="{{ url_for('admin_teams') }}">Διαχείριση Ομάδων →</a></p>
</div>

{% endblock %}
