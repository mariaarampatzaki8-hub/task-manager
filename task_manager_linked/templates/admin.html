{% extends "base.html" %}
{% block title %}Admin{% endblock %}
{% block content %}

<h1 class="title" style="color:var(--accent)">Î Î¯Î½Î±ÎºÎ±Ï‚ Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®</h1>

<!-- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· -->
<div class="box">
  <h2 class="subtitle">â• Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î§ÏÎ®ÏƒÏ„Î·</h2>
  <form method="post" action="{{ url_for('admin_create_user') }}">
    <div class="field"><label class="label">ÎŒÎ½Î¿Î¼Î±</label>
      <input class="input" name="name" required>
    </div>
    <div class="field"><label class="label">Email (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
      <input class="input" name="email">
    </div>
    <div class="field"><label class="label">Î§ÏÏÎ¼Î±</label>
      <div class="select">
        <select name="color">
          <option value="blue">ÎœÏ€Î»Îµ</option>
          <option value="green">Î ÏÎ¬ÏƒÎ¹Î½Î¿</option>
          <option value="purple">ÎœÏ‰Î²</option>
          <option value="pink">Î¡Î¿Î¶</option>
          <option value="red">ÎšÏŒÎºÎºÎ¹Î½Î¿</option>
          <option value="orange">Î Î¿ÏÏ„Î¿ÎºÎ±Î»Î¯</option>
        </select>
      </div>
    </div>
    <div class="field"><label class="label">Î‘ÏÏ‡Î¹ÎºÏŒ Username (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
      <input class="input" name="username">
    </div>
    <div class="field"><label class="label">Î‘ÏÏ‡Î¹ÎºÏŒÏ‚ ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒÏ‚)</label>
      <input class="input" type="password" name="password">
    </div>
    <button class="button is-link" style="background:var(--accent)">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</button>
  </form>
</div>

<!-- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î±Ï‚ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ -->
<div class="box">
  <h2 class="subtitle">ğŸ“ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚</h2>
  <form method="post" action="{{ url_for('admin_create_task') }}">
    <div class="field"><label class="label">Î¤Î¯Ï„Î»Î¿Ï‚</label>
      <input class="input" name="title" required>
    </div>
    <div class="field"><label class="label">Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</label>
      <textarea class="textarea" name="description"></textarea>
    </div>
    <div class="columns">
      <div class="column">
        <label class="label">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
        <input class="input" type="date" name="due_date">
      </div>
      <div class="column">
        <label class="label">ÎÏÎ±</label>
        <input class="input" type="time" name="due_time">
      </div>
      <div class="column">
        <label class="label">Î‘Î½Î¬Î¸ÎµÏƒÎ· ÏƒÎµ</label>
        <div class="select is-fullwidth">
          <select name="assignee_id">
            <option value="">â€” ÎšÎ±Î½Î­Î½Î±Î½ â€”</option>
            {% for u in users %}
              <option value="{{ u.id }}">{{ u.name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>
    <button class="button is-link" style="background:var(--accent)">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
  </form>
</div>

<!-- Î›Î¯ÏƒÏ„Î± Î§ÏÎ·ÏƒÏ„ÏÎ½ -->
<div class="box">
  <h2 class="subtitle">ğŸ‘¥ Î§ÏÎ®ÏƒÏ„ÎµÏ‚</h2>
  <table class="table is-fullwidth is-striped">
    <thead>
      <tr><th>ÎŒÎ½Î¿Î¼Î±</th><th>Î§ÏÏÎ¼Î±</th><th>Link</th><th>Username</th><th>ÎšÏ‰Î´Î¹ÎºÏŒÏ‚</th><th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th></tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u.name }} {% if u.is_admin %}<span class="tag is-info">admin</span>{% endif %}</td>

        <!-- Î‘Î»Î»Î±Î³Î® Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚ (Î£Î©Î£Î¤ÎŸ endpoint: admin_set_color) -->
        <td>
          <form method="post" action="{{ url_for('admin_set_color', user_id=u.id) }}">
            <div class="select">
              <select name="color" onchange="this.form.submit()">
                {% for opt in ['blue','green','purple','pink','red','orange'] %}
                  <option value="{{ opt }}" {% if u.color==opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
              </select>
            </div>
          </form>
        </td>

        <td><code>/login/{{ u.token }}</code></td>

        <!-- Î‘Î»Î»Î±Î³Î® username/ÎºÏ‰Î´Î¹ÎºÎ¿Ï (Î£Î©Î£Î¤ÎŸ endpoint: admin_set_credentials) -->
        <td>
          <form method="post" action="{{ url_for('admin_set_credentials', user_id=u.id) }}">
            <input class="input" name="username" value="{{ u.username or '' }}" placeholder="username">
        </td>
        <td>
            <input class="input" name="password" type="password" placeholder="Î½Î­Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚">
        </td>
        <td>
            <button class="button is-small" style="background:var(--accent);color:#fff">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
          </form>

          <!-- Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· token (Î£Î©Î£Î¤ÎŸ endpoint: admin_reset_token) -->
          <form method="post" action="{{ url_for('admin_reset_token', user_id=u.id) }}" style="display:inline" onsubmit="return confirm('Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· link Ï‡ÏÎ®ÏƒÏ„Î·;');">
            <button class="button is-small is-light">Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· link</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Î›Î¯ÏƒÏ„Î± Î•ÏÎ³Î±ÏƒÎ¹ÏÎ½ -->
<div class="box">
  <h2 class="subtitle">ğŸ“‹ Î•ÏÎ³Î±ÏƒÎ¯ÎµÏ‚</h2>
  <table class="table is-fullwidth is-striped">
    <thead><tr><th>Î¤Î¯Ï„Î»Î¿Ï‚</th><th>Î£Îµ Ï€Î¿Î¹Î¿Î½</th><th>Î ÏÎ¿Î¸ÎµÏƒÎ¼Î¯Î±</th><th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th><th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th></tr></thead>
    <tbody>
      {% for t in tasks %}
      <tr>
        <td>{{ t.title }}</td>
        <td>{{ t.assignee.name if t.assignee else 'â€”' }}</td>
        <td>
          {% if t.due_date %}{{ t.due_date.strftime('%d/%m/%Y') }}{% endif %}
          {% if t.due_time %} {{ t.due_time.strftime('%H:%M') }}{% endif %}
        </td>
        <td>
          {% if t.status == 'done' %}
            <span class="tag is-success">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î·</span>
          {% else %}
            <span class="tag is-warning">Î‘Î½Î¿Î¹Ï‡Ï„Î®</span>
          {% endif %}
        </td>
        <td>
          <form method="post" action="{{ url_for('admin_delete_task', task_id=t.id) }}" onsubmit="return confirm('Î”Î¹Î±Î³ÏÎ±Ï†Î®;');">
            <button class="button is-small is-danger">Î”Î¹Î±Î³ÏÎ±Ï†Î®</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
