{% extends "base.html" %}
{% block content %}
<h1>Admin</h1>

<section>
  <h2>Δημιουργία & Ανάθεση Task</h2>
  <form action="{{ url_for('admin_create_task') }}" method="post" class="form-grid">
    <label>Τίτλος
      <input type="text" name="title" required>
    </label>

    <label>Ανάθεση σε χρήστη
      <!-- Μπορείς είτε input username, είτε select. Δίνω ΚΑΙ τα δύο· χρησιμοποίησε ό,τι θες. -->
      <!-- Επιλογή με select: -->
      <select name="assignee_username">
        {% for u in users %}
          <option value="{{ u.username }}">{{ u.username }}</option>
        {% endfor %}
      </select>
      <!-- ή πεδίο κειμένου (αν προτιμάς): <input type="text" name="assignee_username" placeholder="username"> -->
    </label>

    <label>Πρόοδος (0–100)
      <input type="number" name="progress" min="0" max="100" value="0">
    </label>

    <button type="submit">Αποθήκευση</button>
  </form>
</section>

<hr>

<section>
  <h2>Υπάρχοντα Tasks</h2>
  {% if tasks and tasks|length > 0 %}
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Τίτλος</th>
          <th>Ανάθεση</th>
          <th>Κατάσταση</th>
          <th>Πρόοδος</th>
          <th>Ενέργειες</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tasks %}
          <tr>
            <td>{{ t.id }}</td>
            <td>{{ t.title }}</td>
            <td>{{ user_map.get(t.assignee_id, '—') }}</td>
            <td>{{ 'Ολοκληρωμένο' if t.status == 'done' else 'Ανοιχτό' }}</td>
            <td>{{ t.progress }}%</td>
            <td class="actions">
              <form action="{{ url_for('admin_toggle_task', task_id=t.id) }}" method="post" style="display:inline">
                <button type="submit">{{ 'Άνοιγμα' if t.status == 'done' else 'Ολοκλήρωση' }}</button>
              </form>
              <form action="{{ url_for('admin_delete_task', task_id=t.id) }}" method="post" style="display:inline" onsubmit="return confirm('Σίγουρα;')">
                <button type="submit">Διαγραφή</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Δεν υπάρχουν tasks.</p>
  {% endif %}
</section>

<hr>

<section>
  <h2>Δημιουργία Χρήστη</h2>
  <form action="{{ url_for('admin_create_user') }}" method="post" class="form-grid">
    <label>Username
      <input type="text" name="username" required minlength="3" placeholder="π.χ. jdoe">
    </label>

    <label>Ονοματεπώνυμο
      <input type="text" name="name" placeholder="π.χ. Γιάννης Δοκιμή">
    </label>

    <label>ΑΔΤ
      <input type="text" name="id_card" placeholder="π.χ. ΑΒ123456">
    </label>

    <label>Τηλέφωνο
      <input type="tel" name="phone" placeholder="π.χ. 69xxxxxxxx">
    </label>

    <label>Email
      <input type="email" name="email" placeholder="name@example.com">
    </label>

    <label>Προσωρινός κωδικός
      <input type="password" name="password" required minlength="6" placeholder="π.χ. Temp*123">
    </label>

    <label>Χρώμα
      <input type="color" name="color" value="#3273dc">
    </label>

    <label>Ομάδα
      <select name="team_id">
        <option value="">— καμία —</option>
        {% for g in teams %}
          <option value="{{ g.id }}">{{ g.name }}</option>
        {% endfor %}
      </select>
    </label>

    <label style="align-self:end">
      <input type="checkbox" name="is_admin"> Admin
    </label>

    <button type="submit">Δημιουργία</button>
  </form>
</section>

<hr>

<section>
<section>
  <h2>Χρήστες</h2>

  {% if users and users|length %}
  <table class="table">
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Τηλέφωνο</th>
        <th>ΑΔΤ</th>
        <th>Χρώμα</th>
        <th>Ομάδα</th>
        <th>Admin</th>
        <th>Ενέργειες</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <form action="{{ url_for('admin_update_user', user_id=u.id) }}" method="post">
          <td><strong>{{ u.username }}</strong></td>

          <td>
            <input type="email" name="email" value="{{ u.email or '' }}" placeholder="name@example.com">
          </td>

          <td>
            <input type="tel" name="phone" value="{{ u.phone or '' }}" placeholder="69xxxxxxxx">
          </td>

          <td>
            <input type="text" name="id_card" value="{{ u.id_card or '' }}" placeholder="ΑΒ123456">
          </td>

          <td>
            <input type="color" name="color" value="{{ u.color or '#3273dc' }}">
          </td>

          <td>
            <select name="team_id">
              <option value="">— καμία —</option>
              {% for g in teams %}
                <option value="{{ g.id }}" {% if u.team_id == g.id %}selected{% endif %}>{{ g.name }}</option>
              {% endfor %}
            </select>
          </td>

          <td style="text-align:center">
            <input type="checkbox" name="is_admin" {% if u.is_admin %}checked{% endif %}>
          </td>

          <td class="actions">
            <button type="submit">Αποθήκευση</button>
        </form>

        <form action="{{ url_for('admin_reset_password', user_id=u.id) }}"
              method="post" style="display:inline"
              onsubmit="return confirm('Reset κωδικού για {{ u.username }};');">
          <button type="submit">Reset κωδικού</button>
        </form>
          </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="muted">Δεν υπάρχουν χρήστες.</p>
  {% endif %}
</section>
{% endblock %}
