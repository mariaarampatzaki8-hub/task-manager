{% extends "base.html" %}
{% block content %}
<h1>Σημειώσεις</h1>

<form action="{{ url_for('notes') }}" method="post" class="form-grid" style="max-width:720px;">
  <label>Τίτλος
    <input type="text" name="title" required>
  </label>
  <label>Κείμενο
    <textarea name="body" rows="3" required></textarea>
  </label>
  <button type="submit">Προσθήκη</button>
</form>

<hr>

{% if notes %}
  <table class="table">
    <thead>
      <tr>
        <th>#</th>
        <th>Τίτλος</th>
        <th>Κείμενο</th>
        <th>Από</th>
        <th>Ημ/νία</th>
        <th>Απάντηση (admin)</th>
        <th>Ενέργειες</th>
      </tr>
    </thead>
    <tbody>
  {% for n in notes %}
    <tr>
      <td>{{ n.id }}</td>
      <td>{{ n.title }}</td>
      <td style="white-space:pre-wrap">{{ n.body }}</td>
      <td>{{ n.author.name or n.author.username }}</td>
      <td>{{ n.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
      <td style="white-space:pre-wrap">
        {% if user.is_admin %}
          <form action="{{ url_for('admin_reply_note', note_id=n.id) }}" method="post">
            <textarea name="reply" rows="2" placeholder="Απάντηση admin...">{{ n.reply or '' }}</textarea>
            <button type="submit">Αποθήκευση</button>
          </form>
        {% else %}
          {{ n.reply or '—' }}
        {% endif %}
      </td>
      <td class="actions">
        {% if user.is_admin or user.id == n.user_id %}
          <form action="{{ url_for('delete_note', note_id=n.id) }}" method="post"
                onsubmit="return confirm('Διαγραφή σημείωσης #{{ n.id }};');">
            <button type="submit">Διαγραφή</button>
          </form>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
</tbody>
